<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="library/forge/forge.min.js"></script>
    <style>
        body{
            background-color : darkgray;
            color: limegreen;
        }
        p{
            color: limegreen;
        }
        textarea{
            background-color: black;
            color: white;
        }
        
    </style>

    <script>
        
    </script>
</head>
<body >
    <table>
        <tr>
            <td><p>Public Key</p></td>
            <td><textarea name="" id="plaintext" cols="30" rows="10"></textarea></td>
            <td></td>
        </tr>
        <tr>
            <td><p>Encrypted Text</p></td>
            <td><textarea name="" id="cipher" cols="30" rows="10"></textarea></td>
            <td> <button onclick="">encrypt</button> </td>
        </tr>
        <tr>
            <td><p>Decrypted</p></td>
            <td><textarea name="" id="decrypted" cols="30" rows="10"></textarea></td>
            <td><button onclick=""> Decrypt </button></td>
        </tr>
        <tr>
            <td><p>Public</p></td>
            <td><textarea name="" id="public" cols="30" rows="10"></textarea></td>
            <td><button onclick="createKey()">Generate</button></td>
        </tr>
        <tr>
            <td><p>Private</p></td>
            <td><textarea name="" id="private" cols="30" rows="10"></textarea></td>
            <td><button id="" onclick="reGenerate()">ReGenerate</button></td>
        </tr>
    </table>
    <script>
        let state;
        let pki;
        let parser = new DOMParser();
        const charset = "MNBVCXY123ASDFGHJKL654QWERTZUIOP789qwertzuioplkjhgfdsamnbvcxy";
        function setup() {
            state = new State();  
        }
        function createKey() {
            
        }
        function importKey(data) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    
                }
            };
            xhttp.open("GET", "filename", true);
            xhttp.send(); 
        }
        function encrypt() {
            
        }

        function PublicToXml(data) {
            x = pki.publicKeyToPem(key.publicKey);
            return "<key>"+x+"</key>";
        }

        function PublicFromXml(data) {
            let xmlDoc = parser.parseFromString(data,"text/xml");
            y = xmlDoc.getElementsByTagName("key").valu;
            x = pki.publicKeyFromPem(y);
            return x;
        }

        function getRandomString(length) {
            out = "";
            x = 0;
            for (let i = 0; i < length; i++) {
                x = Math.random(charset.length);
                out = out + charset[x];
            }
            return out;
        }

        class State {
            constructor(){
                this.user = new User;
                this.scrypt = new SCrypt;
            }

            loadState(){
                if (typeof(Storage) !== "undefined") {

                }
            }

            saveState(){
                if (typeof(Storage) !== "undefined") {
                    data = {
                        user : {
                            username : this.user.name,
                            id : this.user.id
                        },
                        keys : {
                            clientPub : pki.publicKeyToPem(this.scrypt.keyClient.publicKey),
                            clientPri : pki.privateKeyToPem(this.scrypt.keyClient.privateKey),
                            serverPub : pki.publicKeyToPem(this.scrypt.keyServer)
                        }
                    };
                }
            }

            clearState(){
                if (typeof(Storage) !== "undefined") {
                    
                }
            }
        }

        class User {
            constructor(){
                this.username = "";
                this.id = getRandomString(16);
            }
        }

        class SCrypt {
            constructor(){
                this.keyClient = forge.rsa.generateKeyPair();
                this.keyServer = null;
                this.symmetricKey = null;
            }

            setServerKey(data) {
                this.keyServer = pki.publicKeyFromPem(data);
            }

        }
        
        setup();
    </script>
</body>
</html>